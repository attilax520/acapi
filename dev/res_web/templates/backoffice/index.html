$def with (msg=None, user_type=0, user_id=None, need_login=0,login_error=0,username=None)

<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<meta name="description" content="智能$produkt_name" />
	<meta name="author" content="" />
	
	<title>${produkt_name}</title>

	<link rel="stylesheet" href="/backoffice/assets/css/fonts/linecons/css/linecons.css">
	<link rel="stylesheet" href="/backoffice/assets/css/fonts/fontawesome/css/font-awesome.min.css">
	<link rel="stylesheet" href="/backoffice/assets/css/bootstrap.css">
	<link rel="stylesheet" href="/backoffice/assets/css/xenon-core.css">
	<link rel="stylesheet" href="/backoffice/assets/css/xenon-forms.css">
	<link rel="stylesheet" href="/backoffice/assets/css/xenon-components.css">
	<link rel="stylesheet" href="/backoffice/assets/css/xenon-skins.css">
	<link rel="stylesheet" href="/backoffice/assets/css/custom.css">
	<link rel="stylesheet" href="/backoffice/tab.css">

	<script _src="/backoffice/assets/js/jquery-2.0.3.min.js"></script>
    <script src="/backoffice/assets/js/jquery-1.7.1.min.js"></script>

	<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
		<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->
	<style type="text/css">
		.navbar{
			box-shadow:0px 0px 1px rgba(0, 0, 0, 0.15);
		}
	</style>
	<script type="text/javascript">
		var clickTimeout = {
			_timeout:null,
			set:function(fn){
				var that = this;
				that.clear();
				that._timeout=window.setTimeout(fn,200);
			},
			clear:function(fn){
				var that = this;
				if (that._timeout) {
					window.clearTimeout(that._timeout);
				}
			}
		};

        $$(document).ready(function() {
            $$("#main-menu li ul a").click(function() {
            	clickPer(this);
            });
            $$("#setotp").click(function() {
                clickPer(this);
            });
            $$("#setotpSecond").click(function() {
                clickPer(this);
            });
            $$("#person_info").click(function() {
                clickPer(this);
            });
            $$("#person_pass").click(function() {
                clickPer(this);
            });
            $$("#dashboard_start").click(function() {
                clickPer(this);
            });
            $$("#paymentgatewaystart").click(function() {
                clickPer(this);
            });
            $$("#main-menu li ul a").dblclick(function() {
                clickTimeout.clear();
                addTab($$(this));
            });
            $$("#setotp").dblclick(function() {
                clickTimeout.clear();
                addTab($$(this));
            });
            $$("#setotpSecond").dblclick(function() {
            	clickTimeout.clear();
                addTab($$(this));
            });
            $$("#person_info").dblclick(function() {
            	clickTimeout.clear();
                addTab($$(this));
            });
            $$("#person_pass").dblclick(function() {
            	clickTimeout.clear();
                addTab($$(this));
            });
            $$("#dashboard_start").dblclick(function() {
            	clickTimeout.clear();
                addTab($$(this));
            });
            $$("#paymentgatewaystart").dblclick(function() {
            	clickTimeout.clear();
                addTab($$(this));
            });


            $$('#tabs a.tab').live('click', function() {
                // Get the tab name
                var contentname = $$(this).attr("id") + $$(this).attr("rel");

                // hide all other tabs
                $$("#contentt iframe").each(function(){
	            	$$(this).css("display","none");
	            });
                $$("#tabs li").removeClass("current");

                // show current tab
                $$("#" + contentname).show();
                $$(this).parent().addClass("current");
            });

            $$('#tabs a.remove').live('click', function() {
                // Get the tab name
                var tabid = $$(this).parent().find(".tab").attr("id");

                // remove tab and related content
                var contentname = tabid + $$(this).attr("rel");
                $$("#" + contentname).remove();
                $$(this).parent().remove();

                // if there is no current tab and if there are still tabs left, show the first one
                if ($$("#tabs li.current").length == 0 && $$("#tabs li").length > 0) {

                    // find the first tab    
                    var firsttab = $$("#tabs li:first-child");
                    firsttab.addClass("current");

                    // get its link name and show related content
                    var firsttabid = $$(firsttab).find("a.tab").attr("id");
                    var firsttabrel = $$(firsttab).find("a.tab").attr("rel");
                    $$("#" + firsttabid + firsttabrel).show();
                }
                addRemoveTabRe(tabid,$$(this).attr("rel"),'cancel');
            });
        });
        function clickPer(obj){
        	var per = obj;
        	var name = $$(obj).attr("rel");
        	var length = $$("#" + $$($$(obj)).attr("rel")).length;
        	clickTimeout.set(function(){
        		if (length != 0){
            		$$("#tabs li a[id='"+name+"']").click();
            	}else{
            		addTab($$(per));
            	}
        	});
        }
        function addTab(link) {
            // If tab already exist in the list, return
            /*if ($$("#" + $$(link).attr("rel")).length != 0)
                return;*/
            var times = new Date().getTime();
            // hide other tabs
            $$("#tabs li").removeClass("current");
            $$("#contentt iframe").hide();
            
            // add new tab and related content
            $$("#tabs").append("<li class='current'><a class='tab' rel = '"+times+"' id='" +
                $$(link).attr("rel") + "' href='#'>" + $$(link).html() + 
                "</a><a href='#' class='remove' rel='"+times+"'>x</a></li>");

            $$("#contentt").append("<iframe id='" + $$(link).attr("rel") +""+ times+"' src='" + $$(link).attr("title") + "' frameborder='0' style='width:100%;height:100%;' _onload='identity2()'></iframe>");
            
            // set the newly added tab as current
            $$("#" + $$(link).attr("rel") + times).show();
            addRemoveTabRe($$(link).attr("rel"),times,'add');
        }

        /*for stay the prevent page and open it if fresh*/
        var array = new Array();
        function addRemoveTabRe(name,time,operation){
        	if (operation=="add") {
        		var per = createTab(name,time);
        		array.push(per);
        		/*$$("#main-menu li ul a[rel='"+name+"']").click();*/
        	}else{
        		for (var i = 0; i < array.length; i++) {
        			if (array[i].time == time&&array[i].name == name) {
        				if (i==0) {
        					array.shift();
        				}else{
        					array.splice(i,i);
        				}
        			}
        		}
        	}
        	var arrayName = new Array();
        	for (var j = 0; j < array.length; j++) {
        		arrayName.push(array[j].name);
        	}
        	var arraylast = arrayName.join("-");
        	setCookie("parentPage",arraylast);
        }

        function createTab(name,time){
        	var littleTab = new Object();
        	littleTab.name = name;
        	littleTab.time = time;
        	return littleTab;
        }

        function setCookie(name, value)   
		{   
		   var argv = setCookie.arguments;   
		   var argc = setCookie.arguments.length;   
		   var expires = (argc > 2) ? argv[2] : null;   
		   if(expires!=null)   
		   {   
		       var LargeExpDate = new Date ();   
		       LargeExpDate.setTime(LargeExpDate.getTime() + (expires*1000*3600*24));           
		   }   
		   document.cookie = name + "=" + escape (value)+((expires == null) ? "" : ("; expires=" +LargeExpDate.toGMTString()));   
		}  
		

		function getCookie(Name)   
		{   
		   var search = Name + "="   
		   if(document.cookie.length > 0)   
		   {   
		       offset = document.cookie.indexOf(search)   
		       if(offset != -1)   
		       {   
		           offset += search.length   
		           end = document.cookie.indexOf(";", offset)   
		           if(end == -1) end = document.cookie.length   
		           return unescape(document.cookie.substring(offset, end))   
		       }   
		       else return ""   
		   }   
		}   
    </script>
</head>
<body class="page-body" style="background-color:#ffffff">
	
	<div class="page-container"><!-- add class "sidebar-collapsed" to close sidebar by default, "chat-visible" to make chat appear always -->
			
		<!-- Add "fixed" class to make the sidebar fixed always to the browser viewport. -->
		<!-- Adding class "toggle-others" will keep only one menu item open at a time. -->
		<!-- Adding class "collapsed" collapse sidebar root elements and show only icons. -->
		<div class="sidebar-menu toggle-others fixed">
			$:render.menu_left(user_type, user_id=user_id)
		</div>
		
		<div class="main-content" style="width:100%">
					
			<!-- User Info, Notifications and Menu Bar -->
			<nav class="navbar user-info-navbar" role="navigation">
				
				$:render.menu_top(username)
				
			</nav>

			<ul id="tabs" style="margin-top:-30px;"></ul>
			<div id="contentt" style="height:93%; width:100%; _margin-right:-30px;background-color:#ffffff"></div>
			
		</div>
		
			

	</div>
	
	






	<!-- Imported scripts on this page -->
	<script src="/backoffice/assets/js/rwd-table/js/rwd-table.min.js"></script>


	<!-- JavaScripts initializations and stuff -->
	<script src="/backoffice/assets/js/xenon-custom.js"></script>

	<!-- Bottom Scripts -->
	<script src="/backoffice/assets/js/bootstrap.min.js"></script>
	<script src="/backoffice/assets/js/TweenMax.min.js"></script>
	<script src="/backoffice/assets/js/resizeable.js"></script>
	<script src="/backoffice/assets/js/joinable.js"></script>
	<script src="/backoffice/assets/js/xenon-api.js"></script>
	<script src="/backoffice/assets/js/xenon-toggles.js"></script>
	
	<script type="text/javascript">
		onload=identity;
		function identity(){
			var need_login=$need_login;
			var login_error=$login_error;
			if (need_login!=0||login_error!=0) {
				$$("#warning_setopt").css("display","");
				$$("#warning_setopt_content").css("display","");
			}else{
				$$("#warning_setopt").css("display","none");
				$$("#warning_setopt_content").css("display","none");
			}
			var arraynow = getCookie("parentPage");
			var nowtoarray = arraynow.split("-");
			for (var k = 0; k < nowtoarray.length; k++) {
				$$("#main-menu li ul a[rel='"+nowtoarray[k]+"']").dblclick();
				if (nowtoarray[k]=="个人信息") {
					$$("#person_info").dblclick();
				}
				if (nowtoarray[k]=="修改密码") {
					$$("#person_pass").dblclick();
				}
				if (nowtoarray[k]=="首页" || nowtoarray[k]=="%u9996%u9875") {
					$$("#dashboard_start").dblclick();
				}
			}
			
			if(nowtoarray == "" || !nowtoarray.length)
    			{
    			$$("#dashboard_start").dblclick();
    			}
    			
		}

		function identity2()
		{
			$$.ajax({
			   type: "POST",
			   url: "/settings/otp",
			   data: "action=getStatus",
	           dataType:'json',
			   success: function(msg){
			   	  if (msg==0) {
			   	  	$$("#warning_setopt").css("display","none");
					$$("#warning_setopt_content").css("display","none");
			   	  }else{
			   	  	$$("#warning_setopt").css("display","");
					$$("#warning_setopt_content").css("display","");
			   	  }
			   }
			});
		}

	</script>


</body>
</html>
